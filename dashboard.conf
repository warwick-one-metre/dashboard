server {
    listen 80;
    server_name _, localhost;

    # Static website files
    location /static {
        alias /srv/dashboard/static;
    }

    # Webcam and microphone forwarding
    location /webcam/onemetre/live {
        proxy_pass http://192.168.0.43/mjpg/1/video.mjpg;
    }

    location /webcam/onemetre/static {
        proxy_pass http://192.168.0.43/jpg/1/image.jpg;
    }

    location /webcam/nites/live {
        proxy_pass http://192.168.0.83/mjpg/1/video.mjpg;
    }

    location /webcam/nites/static {
        proxy_pass http://192.168.0.83/jpg/1/image.jpg;
    }

    location /microphone/onemetre {
        proxy_pass http://192.168.0.104:9000/dome.mp3;
    }

    # Static files generated via systemd
    location /data/onemetre {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET';
        add_header 'Content-Type' 'application/json';
        add_header 'Access-Control-Allow-Headers' 'DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type';
        alias /srv/dashboard/generated/onemetre-dashboard.json;
    }

    location /data/onemetre/blue {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET';
        add_header 'Content-Type' 'application/json';
        add_header 'Access-Control-Allow-Headers' 'DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type';
        alias /srv/dashboard/generated/dashboard-BLUE.json;
    }

    location /data/onemetre/blue/image {
        default_type image/png;
        alias /srv/dashboard/generated/dashboard-BLUE-thumb.png;
    }

    location /data/onemetre/red {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET';
        add_header 'Content-Type' 'application/json';
        add_header 'Access-Control-Allow-Headers' 'DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type';
        alias /srv/dashboard/generated/dashboard-RED.json;
    }

    location /data/onemetre/red/image {
        default_type image/png;
        alias /srv/dashboard/generated/dashboard-RED-thumb.png;
    }

    # Dynamic web content
    location / {
        uwsgi_pass unix:/srv/dashboard/uwsgi.sock;
        include uwsgi_params;
    }
}
