---
layout: default
title: "Current Run"
sidebar: "onemetre"
navorder: 1
permalink: /onemetre/reduction/
---
<style>
.overlaybutton {
  background: rgba(255, 255, 255, 0.2);
}

a:hover .overlaybutton {
  color: #1ca8dd;
}
</style>
<div class="dashhead">
  <div class="dashhead-titles">
    <h2 class="dashhead-title">One Metre &raquo; Current Run</h2>
    <h2 class="dashhead-subtitle">Automatically updates every 10 seconds</h2>
  </div>
</div>
<hr class="m-t">

<div class="row">
  <div class="col-md-6">
    <div class="list-group list-group-item panel" style="padding:0">
      <img id="blue" data-url="/dashboard/onemetre/blue/image" width="100%">
    </div>
    <div id="blue-stats"></div>
  </div>
  <div class="col-md-6">
    <div class="list-group list-group-item panel" style="padding:0">
      <img id="red" data-url="/dashboard/onemetre/red/image" width="100%">
    </div>
    <div id="red-stats"></div>
  </div>
</div>

<script>

var lastDate = {'red': 0, 'blue': 0};

function updateCamera(id) {
  $.ajax({
    type: "GET",
    url: "/dashboard/onemetre/" + id + "/json",
    statusCode: {
      404: function() { console.log("Query failed!") }
    }
  }).done(function(msg) {
    var data = jQuery.parseJSON(msg);
    var date = new Date(data['date']);
    if (date > lastDate[id]) {
      var url = $('#' + id).data('url');
      $('#' + id).attr('src', url + '?' + Date.now());
      $('#' + id + '-stats').html(date.toUTCString());
      lastDate[id] = date;
      console.log('updated ' + id + ' at ' + date.toUTCString())
    }
  });
  window.setTimeout(function() { updateCamera(id) }, 10000);
}

function reloadData() {
  $('img').each(function() {
    var url = $(this).data('url');
    $(this).attr('src', url + sep + Date.now());
    if (url) {
      var sep = url.indexOf('?') < 0 ? '?' : '&';
      $(this).attr('src', url + sep + Date.now());
    }
  });
}

$(document).ready(function () {
  updateCamera('blue');
  updateCamera('red');
});

</script>
