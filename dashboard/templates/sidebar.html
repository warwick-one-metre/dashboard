{% set categories = [
  ('Observatory', [
    (url_for('environment'), 'environment', 'Environment', 'icon-cloud', None),
    (url_for('infrastructure'), 'infrastructure', 'Infrastructure', 'icon-home', None),
    (url_for('skycams'), 'skycams', 'Sky Cameras', 'icon-video-camera', None)
  ]),
  ('One Metre', [
    (url_for('onemetre_dashboard'), 'onemetre-dashboard', 'Dashboard', 'icon-menu', None),
    (url_for('onemetre_dome'), 'onemetre-dome', 'Dome Camera', 'icon-video-camera', None),
    (url_for('onemetre_external'), 'onemetre-external', 'Ext. Camera', 'icon-video-camera', None),
    (url_for('onemetre_live'), 'onemetre-live', 'Live Data', 'icon-stopwatch', 'onemetre'),
    (url_for('onemetre_resources'), 'onemetre-resources', 'Resources', 'icon-info', 'onemetre')
  ]),
  ('GOTO', [
    (url_for('goto_dashboard'), 'goto-dashboard', 'Dashboard', 'icon-menu', None),
    (url_for('goto_dome'), 'goto-dome', 'Dome Camera', 'icon-video-camera', None),
    (url_for('goto_external'), 'goto-external', 'Ext. Camera', 'icon-video-camera', None)
  ]),
  ('NITES', [(url_for('nites_dome'), 'nites-dome', 'Dome Camera', 'icon-video-camera', None)]),
] %}

{% set permissions = {
    'onemetre': 'One-metre observer',
    'nites': 'NITES observer'
} %}

<nav class="sidebar-nav">
  <div class="sidebar-header">
    <button class="nav-toggler nav-toggler-sm sidebar-toggler" type="button" data-toggle="collapse" data-target="#nav-toggleable-sm">
      <span class="sr-only">Toggle nav</span>
    </button>
    <h1 class="navbar-brand">Warwick La&nbsp;Palma Telescopes</h1>
  </div>
  <div class="collapse nav-toggleable-sm" id="nav-toggleable-sm">
    <ul class="nav nav-pills nav-stacked m-b">
      {% for title, links in categories %}
      <li class="nav-header">{{ title|e }}</li>
      {% for href, id, caption, icon, permission in links %}
      {% if not permission or permission in user_account['permissions'] %}
      <li{% if id == active_page %} class="active"{% endif %}>
        <a class="hidden-sm" href="{{ href|e }}">{% if icon %}<span class="icon {{ icon }}" style="margin-right: 10px"></span>{% endif %}{{ caption|e }}</a>
        <a class="visible-sm" href="{{ href|e }}" style="font-size: 0.75em">{% if icon %}<span class="icon {{ icon }}" style="margin-right: 5px"></span>{% endif %}{{ caption|e }}</a>
      </li>
      {% endif %}
      {% endfor %}
      {% endfor %}
    </ul>

    <hr style="margin: 0px" class="m-b">

    {% if user_account['username'] != None and user_account['avatar'] != None %}
      <div class="clearfix">
        <img style="border-radius: 3px; margin-right: 5px; float: left;" src="{{ user_account['avatar'] }}" width="40" height="40">
        <h4 style="margin: 0; margin-top: 8px; overflow:hidden; text-overflow: ellipsis; height: 32px;">@{{ user_account['username'] }}</h4>
      </div>
      <ul class="user-permissions">
      {% if user_account['permissions']|length > 0 %}
        {% if 'onemetre' in user_account['permissions'] %}
          <li>One-metre observer</li>
        {% endif %}
        {% if 'nites' in user_account['permissions'] %}
          <li>NITES observer</li>
        {% endif %}
      {% else %}
        <li>No Permissions</li>
      {% endif %}
      </ul>
      <div class="text-center">
        <a href="{{ url_for('logout') + '?next=' + request.base_url }}" class="btn btn-default-outline btn-sm">Log out</a>
      </div>
    {% else %}
      <div class="text-center">
        <a id="login-button" href="{{ url_for('login') + '?next=' + request.base_url }}" class="btn btn-primary-outline" style="width: 150px; overflow: hidden; text-overflow: ellipsis;">Log in with Github</a>
      </div>
    {% endif %}
    <hr class="visible-xs m-t">
  </div>
</nav>

