{% extends "layout.html" %}
{% set active_page = 'onemetre-dome' -%}
{% block body %}
<div class="dashhead m-b">
  <div class="dashhead-titles">
    <h2 class="dashhead-title">One Metre &raquo; Dome View</h2>
  </div>
</div>

<div class="row">
  <div id="container" class="col-md-12 m-b" style="position: relative">
    <img id="video" src="/webcam/onemetre/static" width="100%">
    <div style="position: absolute; left: 25px; top: 10px; text-align: center;">
      <a id="video-button" class="btn btn-primary-outline p-x overlaybutton" style="margin-bottom: 10px"><img src="{{ url_for('static', filename='video.svg') }}" width="50"/><br /><span id="video-button-text">Play</span></a><br />
    </div>
{% if user_account != None and 'onemetre' in user_account['permissions'] %}
    <div style="position: absolute; right: 25px; top: 10px; text-align: center;">
      <audio id="audio" preload="none"></audio>
      <a id="audio-button" class="btn btn-primary-outline p-x overlaybutton" style="margin-bottom: 10px"><img src="{{ url_for('static', filename='speaker.svg') }}" width="50"/><br /><span id="audio-button-text">Play</span></a><br />
      <input id="audio-volume" type="text" style="width:80px" value="" data-slider-min="0" data-slider-max="1" data-slider-step="0.01" data-slider-value="1" data-slider-selection="after" data-slider-tooltip="hide">
    </div>
{% endif %}
  </div>
{% if user_account != None and 'onemetre' in user_account['permissions'] %}
  <div id="container" class="col-md-12">
    <p class="description">Please note that audio playback requires browser support for streaming mp3 audio.<br />
    <p class="description">Audio playback is delayed by a few seconds, and both audio and video sync may drift over time. Stop and re-start playback to resync the time.</p>
  </div>
{% endif %}
</div>
<script src="{{ url_for('static', filename='bootstrap-slider.js') }}"></script>
<script src="{{ url_for('static', filename='onemetre-dome.js') }}"></script>
<script>

$(document).ready(function () {
{% if user_account != None and 'onemetre' in user_account['permissions'] %}
  $('#audio-volume').slider()
  $('#audio-volume').on('slide', function(ev){
    $('#audio').prop('volume', ev.value);
  });

  var audioPlaying = false;
  $('#audio-button').click(function() {
    var player = document.getElementById('audio');
    if (audioPlaying) {
      $('#audio-button-text').html('Play');
      player.src = '';
      audioPlaying = false;
    } else {
      $('#audio-button-text').html('Stop');
      player.src = '/microphone/onemetre';
      player.play();
      audioPlaying = true;
    }
  });
{% endif %}

  var videoPlaying = false;
  $('#video-button').click(function() {
    if (videoPlaying) {
      $('#video-button-text').html('Play');
      $('#video').attr('src', '/webcam/onemetre/static?' + Date.now());
      console.log($('#video').attr('src'));
      videoPlaying = false;
    } else {
      $('#video-button-text').html('Stop');
      $('#video').attr('src', '/webcam/onemetre/live?' + Date.now());

      videoPlaying = true;
    }
  });
});

</script>
{% endblock %}
